<!--
Author: W3layouts
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html>
<head>
	<title>CoupleTrips</title>
	
	<%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => false %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <link href="https://fonts.googleapis.com/css?family=Oxygen" rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,300' rel='stylesheet' type='text/css'>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  
  <%= csrf_meta_tags %>
  <%= yield :customJs %>
	<!--fonts-->
		<!--<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>-->
        
		<!--<link href='http://fonts.googleapis.com/css?family=PT+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>-->
        
	<!--//fonts-->
		<!--<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />-->
		<!--<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />-->
	<!-- for-mobile-apps -->
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="keywords" content="Couple Trips, Love, Trip, Trips, Couple, Leisure" />
    
    
	<!-- //for-mobile-apps -->
	<!-- js -->
		<!--<script type="text/javascript" src="js/jquery.min.js"></script>-->
	<!-- js -->
	
<script>
  // This is called with the results from from FB.getLoginStatus().
  function statusChangeCallback(response) {
    console.log('statusChangeCallback');
    console.log(response);
    // The response object is returned with a status field that lets the
    // app know the current login status of the person.
    // Full docs on the response object can be found in the documentation
    // for FB.getLoginStatus().
    if (response.status === 'connected') {
      // Logged into your app and Facebook.
      testAPI();
    } else if (response.status === 'not_authorized') {
      if($.cookie("external_id") || $.cookie("remember_token")){
        $( "#logout" ).click();
      }
      
      console.log('Please log ' + 'into this app.');
    } else {
      if($.cookie("external_id") || $.cookie("remember_token")){
        $( "#logout" ).click();
      }
      // The person is not logged into Facebook, so we're not sure if
      // they are logged into this app or not.
      console.log('Please log ' + 'into Facebook.');
    }
  }

  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.
  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }

  window.fbAsyncInit = function() {
  FB.init({
    appId      : '1138815052812962',
    cookie     : true,  // enable cookies to allow the server to access 
                        // the session
    xfbml      : true,  // parse social plugins on this page
    version    : 'v2.5' // use version 2.2
  });
  
 

  // Now that we've initialized the JavaScript SDK, we call 
  // FB.getLoginStatus().  This function gets the state of the
  // person visiting this page and can return one of three states to
  // the callback you provide.  They can be:
  //
  // 1. Logged into your app ('connected')
  // 2. Logged into Facebook, but not your app ('not_authorized')
  // 3. Not logged into Facebook and can't tell if they are logged into
  //    your app or not.
  //
  // These three cases are handled in the callback function.

  FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });

  };

  // Load the SDK asynchronously
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));

  // Here we run a very simple test of the Graph API after login is
  // successful.  See statusChangeCallback() for when this call is made.
  function testAPI() {
    console.log('Welcome!  Fetching your information.... ');
    FB.api('/me?fields=id,name,picture,email', function(response) {
      console.log('Successful login for: ' + response.name);
      console.log(response);
      
      if(!(($.cookie("remember_token")) && ($.cookie("external_id") == response.id))){
        
          $.ajax({
            type: "POST",
            url: "/login_request",
            data: {
              user: {
                external_id: response.id,
                access_token: FB.getAccessToken(),
                email: response.email,
                name: response.name,
                profile_pictures: response.picture.data.url
              }
            }
          }).done(
            function(data){
              console.log("returned from login_request" + data);
              $('#myModal').modal('hide')
              $("#signouttext").text(response.name.split(" ")[0]);
              $("#signinli").hide();
              $(".dropdown").show();
              $("#profileimage").attr('src', response.picture.data.url);
              $("#profileimage").show();
              
            });
        }
    });
  }
      
  
</script>


</head>
<body>
  <div class="page-wrap">
<script>
$( document ).ready(function() {
    $( "#signin" ).click(function() {
            FB.login(function(response){
              checkLoginState();
              
            });
            
            
            
    });
    
    $( "#signinpop" ).click(function() {
            $('#myModal').modal('show');
    });
    
    
    
    $( "#logout" ).click(function() {
            
            FB.logout(function(response) {
                $.removeCookie("remember_token");
                $.removeCookie("external_id");
                location.reload();
            });
            
    });
})
</script>
    

<!-- banner -->
<%= yield %>
    
    
    <div id="preloadimage">
        <img src="/images/CT-Logo-green.png">
    </div>
    <script src="../js/lightbox.js"></script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68130077-1', 'auto');
  ga('send', 'pageview');
    

</script>
    
    
    <script> 
    
    $(function() {
    $(".navbar-brand")
    
        .hover(
        function() { 
            $("img.logo-ct").attr("src", '/images/CT-Logo-green.png');
            $(".navbar-brand").css("background-color","white");
            },
        function() {
           $("img.logo-ct").attr("src", '/images/CT-Logo-2heart.png');
            $(".navbar-brand").css("background-color", "#0EA474" );
        })
        
});
    
</script>

<!-- //banner -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">SIGN IN</h4>
      </div>
      <div class="modal-body">
        <button type="button" class="btn btn-primary btn-lg" id="signin"><img src="/images/fbicon.jpg" height="40px" style="padding-right:5px"> Sign In With Facebook</button>
        <div height="50px"></div>
      </div>
      
    </div>
  </div>
</div>

</div>

<div class="footer">
  
  <div class="center-align-place">
    
    
  <div>
    
    
    
    <span class="social-icons">Follow Us On: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        <a href="https://www.instagram.com/coupletrips.in/"><i class="fa fa-instagram fa-2x"></i></a></span>
    
    <span class="social-icons"><a href="https://twitter.com/coupletrips_in"><i class="fa fa-twitter fa-2x"></i></a></span>
  </div>
  
    
  </div>
  
  
</div>
</body>
</html>